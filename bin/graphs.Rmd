---
title: "graph_func_struct - POND"
author: "nforde"
date: "April 11, 2018"
output: html_document
---

## this is dependent on having edge files available that have previously been generated by the func_struct.Rmd script

## get libraries/set paths
```{r}
library(igraph)
library(dplyr)
library(tidyr)
library(ggplot2)
library(broom)
library(knitr)
library(car)
library(multcomp)

## set all the paths
## set all the paths
pond_demographics <- read.csv("/projects/stephanie/DataFiles_CT.DTI.Beh.POND/GlimExtIN_CTROIUF.csv")
qap_functional_temporal <- read.csv("/mnt/tigrlab/projects/edickie/analysis/POND_RST/qap/qap_functional_temporal.csv")
edgedir <- "/scratch/nforde/homotopic/POND/edge_metrics"

pond_extra <- read.csv("/scratch/nforde/homotopic/POND/pond_demog.csv")

for (i in 1:nrow(pond_extra)) {
  if (startsWith(as.character(pond_extra$subject[i]), "88")) {
    pond_extra$subject[i] <- paste0("0", pond_extra$subject[i])
  }
}
z <-  strsplit(as.character(pond_demographics$DTI.CT.codes),"-")
pond_demographics$subject <- sapply(z,FUN=function(x){paste0(x[1],x[2])})
demogs <- merge(pond_demographics, pond_extra[c(1,2,7:10,12)], by.x="subject", by.y="subject", all.x=TRUE)
demogs <- demogs[!duplicated(demogs$subject),]


```
## function(s)
```{r}

## 
mk_matrices <- function(subids, edgedir) {
  
  for (i in 1:length(subids)) {
    ## 
    edge.file <- file.path(edgedir,
                           paste(subids[i], "edge_metrics.csv", sep="_"))
      
    if (file.exists(edge.file)) {
      edges <- read.csv(edge.file, header =TRUE)
      
      g<- graph_from_data_frame(edges, directed = FALSE, vertices = NULL)
      Mw<- as.matrix(as_adjacency_matrix(g, attr='weight', type = c("both")))
      Mz<- as.matrix(as_adjacency_matrix(g, attr='theseZ', type = c("both")))
      Mts<- as.matrix(as_adjacency_matrix(g, attr='Stability', type = c("both")))
      Ml<- as.matrix(as_adjacency_matrix(g, attr='length', type = c("both")))
      MlQ<- as.matrix(as_adjacency_matrix(g, attr='len_quant', type = c("both")))
      MdwQ<- as.matrix(as_adjacency_matrix(g, attr='dw_quant', type = c("both")))
   
      write.csv(Mw, file.path(edgedir, paste(subids[i], "DWmat.csv", sep="_")), row.names = F)
      write.csv(Mz, file.path(edgedir, paste(subids[i], "Zmat.csv", sep="_")), row.names = F)
      write.csv(Mts, file.path(edgedir, paste(subids[i], "TSmat.csv", sep="_")), row.names = F)
      write.csv(Ml, file.path(edgedir, paste(subids[i], "Lenmat.csv", sep="_")), row.names = F)
      write.csv(MlQ, file.path(edgedir, paste(subids[i], "LenQmat.csv", sep="_")), row.names = F)
      write.csv(MdwQ, file.path(edgedir, paste(subids[i], "dwQmat.csv", sep="_")), row.names = F)
    
    } else {
      print(paste(edge.file, "does not exist"))
    }
  }
}
      
```
## Run 
```{r}
demogs$subid <- paste0("MR160-",demogs$DTI.CT.codes)
demogs <- merge(demogs, qap_functional_temporal, by.x = "subid", by.y = "subject")
demogs <- filter(demogs, perc_fd < 5)

subids <- demogs$subid

mk_matrices(subids, edgedir)

```

## Sort data 
```{r, fig.width=12}

```

## visualisations
```{r, fig.width=12}

```